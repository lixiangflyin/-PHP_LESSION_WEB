<!DOCTYPE html>
<!-- saved from url=(0057)http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011 -->
<html id="customDoc" class="mod-with-msyahei"><!--STATUS OK--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  <title> PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间</title> <link rel="shortcut icon" href="http://hi.bdimg.com/static/qbase/img/mod/16_favicon.ico?v=116ba471.ico" type="image/x-icon">   <meta name="keywords" content="PHP 之 写时复制（Copy On Write）,php,copy-on-write"> <meta name="description" content="我的休闲部落格----既然选择了远方，便只顾风雨兼程！,PHP 之 写时复制（Copy On Write）"><script>window.wpo={start:new Date*1,pid:109,page:'qing'}</script><!--[if IE]><script type="text/javascript">(function(){var e="abbr,article,aside,audio,canvas,datalist,details,dialog,eventsource,figure,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,time,video".split(","),t=e.length;while(t--)document.createElement(e[t])})();</script><![endif]--><script>window.qDomain={"qing":"http://hi.baidu.com","static":"http://hi.bdimg.com","passport":"https://passport.baidu.com","portrait":"http://tx.bdimg.com","hiup":"http://hiup.baidu.com","photo":"http://hiphotos.baidu.com","message":"http://msg.baidu.com","friend":"http://frd.baidu.com","mp3":"http://mp3.baidu.com","ting":"http://ting.baidu.com","image":"http://img.baidu.com","qup":"http://upload.hi.baidu.com","www":"http://www.baidu.com"};window.qUserInfo={"userName":"cxc0378","nickname":"cxc0378","portrait":"b063637863303337380200","qingUrl":"\/cxc0378","spaceName":"Premier&#39;s Casual Home","right":"0","avatarStatus":"1","flagNeedInvite":"0","flagNotInvited":"0","version":"2"};window.qVisitorInfo={"userName":"fengxueken","nickname":"fengxueken","portrait":"dae766656e677875656b656e2a11","isHost": false,"isRandUrl": false,"isForceMoved": false,"loginStatus":"activated","isOldUser":0,"qingUrl":"\/fengxueken","right":"0","version":"2"};window.qPageInfo={"pageUrl":"http:\/\/hi.baidu.com\/cxc0378\/item\/de2441e784fabb0c64db0011","referUrl":"http:\/\/www.baidu.com\/s?ie=utf-8&bs=php%E7%9A%84+copy+on+write&f=8&rsv_bp=1&wd=php+copy+on+write&rsv_sug3=1&rsv_sug1=1&rsv_sug4=85&inputT=1040"};window.qUserAvatar={size20:"http://hiphotos.baidu.com/space/scrop=20;q=100/sign=832a02661e178a82ca6238ff863e41bd/c2fdfc039245d688d5334a0ea4c27d1ed21b2462.jpg",size40:"http://hiphotos.baidu.com/space/scrop=40;q=100/sign=1f1b4718b9014a90856001e2d94a0d22/c2fdfc039245d688d5334a0ea4c27d1ed21b2462.jpg",size65:"http://hiphotos.baidu.com/space/scrop=65;q=100/sign=b80d870af603738dda144b7dc3268664/c2fdfc039245d688d5334a0ea4c27d1ed21b2462.jpg",size110:"http://hiphotos.baidu.com/space/scrop=110;q=100/sign=37df18a3b6003af349e49b3f4517f76d/c2fdfc039245d688d5334a0ea4c27d1ed21b2462.jpg",size160:"http://hiphotos.baidu.com/space/scrop=160;q=100/sign=37df18a3b6003af349e49b3f4517f76a/c2fdfc039245d688d5334a0ea4c27d1ed21b2462.jpg"};window.qVisitorAvatar={size20:"http://hiphotos.baidu.com/space/scrop=20;q=100/sign=2d5c86b397dda144de572bedc28ae292/54fbb2fb43166d226ec13734462309f79152d2df.jpg",size40:"http://hiphotos.baidu.com/space/scrop=40;q=100/sign=b656b6d4ad345982c1d4a2cd7cc9059d/54fbb2fb43166d226ec13734462309f79152d2df.jpg",size65:"http://hiphotos.baidu.com/space/scrop=65;q=100/sign=8cbf4e12b2b7d0a27f9743c2bbd2403c/54fbb2fb43166d226ec13734462309f79152d2df.jpg",size110:"http://hiphotos.baidu.com/space/scrop=110;q=100/sign=f08bad31cd11728b3473cb7db8c1f2ff/54fbb2fb43166d226ec13734462309f79152d2df.jpg",size160:"http://hiphotos.baidu.com/space/scrop=160;q=100/sign=f08bad31cd11728b3473cb7db8c1f2f8/54fbb2fb43166d226ec13734462309f79152d2df.jpg"};window.qBdsToken="4096290fb97655f387b6fb84a12c716c";window.qErrorInfo={"no":"0","msg":""};window.qServerInfo={"timeStamp":"1374048560"};window.qLongPolling={"url":"http:\/\/m.hi.baidu.com\/i\/msg\/listen"}</script><!--[if (lt IE 8.0)]><link href="http://hi.bdimg.com/static/qbase/css/qbase.css?v=52b31f0e.css" type=text/css rel=stylesheet><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link href="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/qbase_datauri.css" type="text/css" rel="stylesheet"><!--<![endif]-->     <!--[if (lt IE 8.0)]><link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qcomment/css/qcomment.css?v=5ba753ab.css"><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link rel="stylesheet" type="text/css" href="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/qcomment_datauri.css"><!--<![endif]--><link rel="stylesheet" type="text/css" href="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/mod_userInfo.css">   <!--[if (lt IE 8.0)]><link type=text/css rel=stylesheet href="http://hi.bdimg.com/static/qhome/css/detail/20001/detail.css?v=635ae796.css"><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link type="text/css" rel="stylesheet" href="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/detail_datauri.css"><!--<![endif]-->    <link rel="stylesheet" type="text/css" href="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/shCoreDefault.css">     <script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/qing.js"></script>  <script>
    /*最终页页面变量*/ 
    window.detailPage = {
        threadId : "de2441e784fabb0c64db0011",
        blogTitle: "PHP 之 写时复制（Copy On Write）" || "无标题",
        contentType : "text",
        originAuthorName : "",
        originPortrait : "",
        originThreadId : ""
    }; 
    </script><script>wpo.head=new Date*1;</script> <link href="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/bdsstyle.css" rel="stylesheet" type="text/css"><style type="text/css" id="undefined"></style><script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/logger.js"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(1)" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(2)" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(3)" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(4)" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(5)" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(6)" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(7)" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(8)" defer="defer"></script><script type="text/javascript" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/listen(9)" defer="defer"></script></head> <body><iframe frameborder="0" style="display: none;"></iframe><div id="bdshare_s" style="display: block;"><iframe id="bdsIfr" style="position:absolute;display:none;z-index:9999;" frameborder="0"></iframe><div id="bdshare_l" style="display: none;"><div id="bdshare_l_c"><h6>分享到</h6><ul><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_mshare mshare">一键分享</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_qzone qqkj">QQ空间</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_tsina xlwb">新浪微博</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_baidu bdsc">百度云收藏</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_renren rrw">人人网</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_tqq txwb">腾讯微博</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_bdxc bdxc">百度相册</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_kaixin001 kxw">开心网</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_tqf txpy">腾讯朋友</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_tieba bdtb">百度贴吧</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_douban db">豆瓣网</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_tsohu shwb">搜狐微博</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_bdhome bdhome">百度新首页</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_sqq sqq">QQ好友</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_thx thx">和讯微博</a></li><li><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="bds_more">更多...</a></li></ul><p><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="goWebsite">百度分享</a></p></div></div></div>  <header class="mod-topbar" id="modTopbar"><iframe class="mod-topbar-bgframe"></iframe><div class="mod-topbar-pseudo-real"><div class="wrapper-box clearfix"><div class="mod-msg-bubble hide" id="mod-msg-bubble"></div><div class="left-box"><a href="http://hi.baidu.com/" class="logo-box"><span id="baiduSpaceLogo" class="q-logo"></span></a></div> <div class="center-box"><ul class="q-menubox"> <li class="q-menuitem "><a href="http://hi.baidu.com/home">首页</a></li><li class="q-menuitem "><a href="http://hi.baidu.com/fengxueken">我的主页</a></li><li class="q-menuitem q-newicon"><a target="_blank" href="http://hi.baidu.com/fengxueken/albums">相册</a></li><li class="q-menuitem " id="qMenuRecommend"><a href="http://hi.baidu.com/index/">广场</a></li><li class="q-menuitem q-newicon"><a href="http://youxi.baidu.com/yxpm/pm.jsp?pid=10106000091_970983" target="_blank">游戏</a></li></ul></div>  <div class="right-box"><ul class="q-navbox">  <li class="q-navitem"> <a href="http://hi.baidu.com/fengxueken/qfriend/show/follow#search">昵称搜索</a>  </li><li class="q-navitem q-nav-sp"><span></span> </li><li class="q-navitem"> <div class="q-msg-unread-tips"> <div class="left"><a href="http://hi.baidu.com/qmsg" id="qNavRightMsg">消息<span id="qMsgUnReadTips">&nbsp;</span></a></div> </div>  </li><li class="q-navitem q-nav-sp"><span></span> </li><li class="q-navitem"> <a href="http://msg.baidu.com/" id="qNavRightLetter" target="_blank">私信<span id="qUnreadNumLetter"></span></a>  </li><li class="q-navitem q-nav-sp"><span></span> </li><li class="q-navitem" id="qThemeNav"> <a href="http://hi.baidu.com/set/show/theme" id="qNavRightTheme">模板</a>  </li><li class="q-navitem q-nav-sp"><span></span> </li><li class="q-navitem"> <a href="http://hi.baidu.com/set/show/profile" id="qNavRightSet">设置</a>  </li><li class="q-navitem q-nav-sp"><span></span> </li><li class="q-navitem"><a href="https://passport.baidu.com/?logout&bdstoken=4096290fb97655f387b6fb84a12c716c&u=http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011" id="qNavRightExit">退出</a> </li></ul><div class="right mod-qhome-follow-box"><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="follow-btn a-btn-follow qing-stat-nsclick" data-nsclick="20121012follow_hdbtnaddcare">关注此空间</a></div> </div> <div class="mod-msg-unread-num hide" style="top: 0px; left: 797px;"><div class="left-border"></div><div class="content"></div><div class="right-border"></div></div></div></div></header>  <section class="mod-page-body"> <div class="mod-page-main wordwrap clearfix">  <div class="x-page-container">    <section class="mod-topspaceinfo mod-cs-header"><div class="head-topbar"></div><div class="container"><h1><a class="space-name cs-header-spacename" href="http://hi.baidu.com/cxc0378">Premier's Casual Home</a></h1><p class="space-description cs-header-spacesummary">我的休闲部落格----既然选择了远方，便只顾风雨兼程！</p></div><div class="head-footer"></div></section>   <div class="mod-blogpage-wraper"> <div class="blog-bg-main-repeat hide"></div>  <div class="grid-80 mod-blogpage"> <div class="blog-bg-main hide"></div>    <div class="mod-text-content mod-post-content mod-cs-contentblock"> <div class="cs-contentblock-bg"></div>   <div class="content-head clearfix">  <div class="content-other-info">  <span>2012-12-18 18:13</span>  </div>   <h2 class="title content-title">PHP 之 写时复制（Copy On Write）</h2>  </div>  <div id="content" class="content mod-cs-content text-content clearfix"> <p>转自：http://www.php-internal.com/book/?p=chapt06/06-06-copy-on-write</p><p><br></p><p>在开始之前，我们可以先看一段简单的代码：<br></p><div><div id="highlighter_365268" class="syntaxhighlighter  php "><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php&nbsp;&nbsp;&nbsp;</code><code class="php comments">//例一</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$foo</code>&nbsp;<code class="php plain">=&nbsp;1;</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$bar</code>&nbsp;<code class="php plain">=&nbsp;</code><code class="php variable">$foo</code><code class="php plain">;</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code>&nbsp;<code class="php variable">$foo</code>&nbsp;<code class="php plain">+&nbsp;</code><code class="php variable">$bar</code><code class="php plain">;</code></div><div class="line number5 index4 alt2"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;执行这段代码，会打印出数字2。从内存的角度来分析一下这段代码“可能”是这样执行的：
分配一块内存给foo变量，里面存储一个1；&nbsp;再分配一块内存给bar变量，也存一个1，最后计算出结果输出。
事实上，我们发现foo和bar变量因为值相同，完全可以使用同一块内存，这样，内存的使用就节省了一个1，
并且，还省去了分配内存和管理内存地址的计算开销。
没错，很多涉及到内存管理的系统，都实现了这种相同值共享内存的策略：<strong>写时复制</strong></p><p>很多时候，我们会因为一些术语而对其概念产生莫测高深的恐惧，而其实，他们的基本原理往往非常简单。
本小节将介绍PHP中写时复制这种策略的实现：</p><div><div id="highlighter_419269" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">写时复制（Copy&nbsp;on&nbsp;Write，也缩写为COW)的应用场景非常多，&nbsp;比如Linux中对进程复制中内存使用的优化，在各种编程语言中，如C++的STL等等中均有类似的应用。&nbsp;COW是常用的优化手段，可以归类于：资源延迟分配。只有在真正需要使用资源时才占用资源，&nbsp;写时复制通常能减少资源的占用。</code></div></div></td></tr></tbody></table></div></div><p>注：&nbsp;为节省篇幅，下文将统一使用COW来表示“写时复制”；</p><p><br></p><p><strong><span style="text-decoration: underline; font-size: 18px;">推迟内存复制的优化</span></strong></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;正如前面所说，PHP中的COW可以简单描述为：如果通过赋值的方式赋值给变量时不会申请新内存来存放
新变量所保存的值，而是简单的通过一个计数器来共用内存，只有在其中的一个引用指向变量的
值发生变化时才申请新空间来保存值内容以减少对内存的占用。
在很多场景下PHP都COW进行内存的优化。比如：变量的多次赋值、函数参数传递，并在函数体内修改实参等。</p><p>下面让我们看一个查看内存的例子，可以更容易看到COW在内存使用优化方面的明显作用：</p><div><div id="highlighter_258396" class="syntaxhighlighter  php  "><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php&nbsp;&nbsp;</code><code class="php comments">//例二</code></div><div class="line number2 index1 alt1"><code class="php variable">$j</code>&nbsp;<code class="php plain">=&nbsp;1;</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">var_dump(memory_get_usage());</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number5 index4 alt2"><code class="php variable">$tipi</code>&nbsp;<code class="php plain">=&nbsp;</code><code class="php functions">array_fill</code><code class="php plain">(0,&nbsp;100000,&nbsp;</code><code class="php string">'php-internal'</code><code class="php plain">);</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">var_dump(memory_get_usage());</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="php variable">$tipi_copy</code>&nbsp;<code class="php plain">=&nbsp;</code><code class="php variable">$tipi</code><code class="php plain">;</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">var_dump(memory_get_usage());</code></div><div class="line number10 index9 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="php keyword">foreach</code><code class="php plain">(</code><code class="php variable">$tipi_copy</code>&nbsp;<code class="php keyword">as</code>&nbsp;<code class="php variable">$i</code><code class="php plain">){</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$j</code>&nbsp;<code class="php plain">+=&nbsp;</code><code class="php functions">count</code><code class="php plain">(</code><code class="php variable">$i</code><code class="php plain">);&nbsp;</code></div><div class="line number13 index12 alt2"><code class="php plain">}</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">var_dump(memory_get_usage());</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number16 index15 alt1"><code class="php comments">//-----执行结果-----</code></div><div class="line number17 index16 alt2"><code class="php plain">$&nbsp;php&nbsp;t.php&nbsp;</code></div><div class="line number18 index17 alt1"><code class="php plain">int(630904)</code></div><div class="line number19 index18 alt2"><code class="php plain">int(10479840)</code></div><div class="line number20 index19 alt1"><code class="php plain">int(10479944)</code></div><div class="line number21 index20 alt2"><code class="php plain">int(10480040)</code></div></div></td></tr></tbody></table></div></div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上面的代码比较典型的突出了COW的作用，在数组变量$tipi被赋值给$tipi_copy时，
内存的使用并没有立刻增加一半，在循环遍历数$tipi_copy时也没有发生显著变化，
在这里$tipi_copy和$tipi变量的数据共同指向同一块内存，而没有复制。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;也就是说，即使我们不使用引用，一个变量被赋值后，只要我们不改变变量的值&nbsp;，也不会新申请内存用来存放数据。
据此我们很容易就可以想到一些COW可以非常有效的控制内存使用的场景：
只是使用变量进行计算而很少对其进行修改操作，如函数参数的传递，大数组的复制等等等不需要改变变量值的情形。</p><p><br></p><p><strong><span style="text-decoration: underline; font-size: 18px;">复制分离变化的值</span></strong></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;多个相同值的变量共用同一块内存的确节省了内存空间，但变量的值是会发生变化的，如果在上面的例子中，
指向同一内存的值发生了变化（或者可能发生变化），就需要将变化的值“分离”出去，这个“分离”的操作，
就是“复制”。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在PHP中，Zend引擎为了区别同一个zval地址是否被多个变量共享，引入了ref_count和is_ref两个变量进行标识：</p><div><div id="highlighter_703243" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">ref_count和is_ref是定义于zval结构体中（见第一章第一小节）</code></div><div class="line number2 index1 alt1"><code class="plain plain">is_ref标识是不是用户使用&nbsp;&amp;&nbsp;的强制引用；</code></div><div class="line number3 index2 alt2"><code class="plain plain">ref_count是引用计数，用于标识此zval被多少个变量引用，即COW的自动引用，为0时会被销毁；</code></div><div class="line number4 index3 alt1"><code class="plain plain">关于这两个变量的更多内容，跳转阅读：第三章第六节：变量的赋值和销毁的实现。</code></div><div class="line number5 index4 alt2"><code class="plain plain">注：由此可见，&nbsp;$a=$b;&nbsp;与&nbsp;$a=&amp;$b;&nbsp;在PHP对内存的使用上没有区别（值不变化时）；</code></div></div></td></tr></tbody></table></div></div><p>下面我们把<strong>例二</strong>稍做变化：如果$copy的值发生了变化，会发生什么？：</p><div><div id="highlighter_866351" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php&nbsp;</code><code class="php comments">//例三</code></div><div class="line number2 index1 alt1"><code class="php comments">//$tipi&nbsp;=&nbsp;array_fill(0,&nbsp;3,&nbsp;'php-internal');&nbsp;&nbsp;</code></div><div class="line number3 index2 alt2"><code class="php comments">//这里不再使用array_fill来填充&nbsp;，为什么？</code></div><div class="line number4 index3 alt1"><code class="php variable">$tipi</code><code class="php plain">[0]&nbsp;=&nbsp;</code><code class="php string">'php-internal'</code><code class="php plain">;</code></div><div class="line number5 index4 alt2"><code class="php variable">$tipi</code><code class="php plain">[1]&nbsp;=&nbsp;</code><code class="php string">'php-internal'</code><code class="php plain">;</code></div><div class="line number6 index5 alt1"><code class="php variable">$tipi</code><code class="php plain">[2]&nbsp;=&nbsp;</code><code class="php string">'php-internal'</code><code class="php plain">;</code></div><div class="line number7 index6 alt2"><code class="php plain">var_dump(memory_get_usage());</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="php variable">$copy</code>&nbsp;<code class="php plain">=&nbsp;</code><code class="php variable">$tipi</code><code class="php plain">;</code></div><div class="line number10 index9 alt1"><code class="php plain">xdebug_debug_zval(</code><code class="php string">'tipi'</code><code class="php plain">,&nbsp;</code><code class="php string">'copy'</code><code class="php plain">);</code></div><div class="line number11 index10 alt2"><code class="php plain">var_dump(memory_get_usage());</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number13 index12 alt2"><code class="php variable">$copy</code><code class="php plain">[0]&nbsp;=&nbsp;</code><code class="php string">'php-internal'</code><code class="php plain">;</code></div><div class="line number14 index13 alt1"><code class="php plain">xdebug_debug_zval(</code><code class="php string">'tipi'</code><code class="php plain">,&nbsp;</code><code class="php string">'copy'</code><code class="php plain">);</code></div><div class="line number15 index14 alt2"><code class="php plain">var_dump(memory_get_usage());</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number17 index16 alt2"><code class="php comments">//-----执行结果-----</code></div><div class="line number18 index17 alt1"><code class="php plain">$&nbsp;php&nbsp;t.php&nbsp;</code></div><div class="line number19 index18 alt2"><code class="php plain">int(629384)</code></div><div class="line number20 index19 alt1"><code class="php plain">tipi:&nbsp;(refcount=2,&nbsp;is_ref=0)=</code><code class="php keyword">array</code>&nbsp;<code class="php plain">(0&nbsp;=&gt;&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">,&nbsp;</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">1&nbsp;=&gt;&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">,&nbsp;</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">2&nbsp;=&gt;&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">)</code></div><div class="line number23 index22 alt2"><code class="php functions">copy</code><code class="php plain">:&nbsp;(refcount=2,&nbsp;is_ref=0)=</code><code class="php keyword">array</code>&nbsp;<code class="php plain">(0&nbsp;=&gt;&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">,&nbsp;</code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">1&nbsp;=&gt;&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">,&nbsp;</code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">2&nbsp;=&gt;&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">)</code></div><div class="line number26 index25 alt1"><code class="php plain">int(629512)</code></div><div class="line number27 index26 alt2"><code class="php plain">tipi:&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php keyword">array</code>&nbsp;<code class="php plain">(0&nbsp;=&gt;&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">,&nbsp;</code></div><div class="line number28 index27 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">1&nbsp;=&gt;&nbsp;(refcount=2,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">,&nbsp;</code></div><div class="line number29 index28 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">2&nbsp;=&gt;&nbsp;(refcount=2,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">)</code></div><div class="line number30 index29 alt1"><code class="php functions">copy</code><code class="php plain">:&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php keyword">array</code>&nbsp;<code class="php plain">(0&nbsp;=&gt;&nbsp;(refcount=1,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">,&nbsp;</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">1&nbsp;=&gt;&nbsp;(refcount=2,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">,&nbsp;</code></div><div class="line number32 index31 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">2&nbsp;=&gt;&nbsp;(refcount=2,&nbsp;is_ref=0)=</code><code class="php string">'php-internal'</code><code class="php plain">)</code></div><div class="line number33 index32 alt2"><code class="php plain">int(630088)</code></div></div></td></tr></tbody></table></div></div><p>在这个例子中，我们可以发现以下特点：</p><ol><li><p>$copy&nbsp;=&nbsp;$tipi；这种基本的赋值操作会触发COW的内存“共享”，不会产生内存复制；</p></li><li><p>COW的粒度为zval结构，由PHP中变量全部基于zval，所以COW的作用范围是全部的变量，而对于zval结构体组成的集合（如数组和对象等），
在需要复制内存时，将复杂对象分解为最小粒度来处理。这样可以使内存中复杂对象中某一部分做修改时，
不必将该对象的所有元素全部“分离复制”出一份内存拷贝；</p></li></ol><div><div id="highlighter_879455" class="syntaxhighlighter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">array_fill()填充数组时也采用了COW的策略，可能会影响对本例的演示，感兴趣的读者可以&nbsp;阅读：$PHP_SRC/ext/standard/array.c中PHP_FUNCTION(array_fill)的实现。</code></div><div class="line number2 index1 alt1"><code class="plain spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number3 index2 alt2"><code class="plain plain">xdebug_debug_zval()是xdebug扩展中的一个函数，用于输出变量在zend内部的引用信息。&nbsp;如果你没有安装xdebug扩展，也可以使用debug_zval_dump()来代替。&nbsp;参考：<a href="http://www.php.net/manual/zh/function.debug-zval-dump.php">http://www.php.net/manual/zh/function.debug-zval-dump.php</a></code></div></div></td></tr></tbody></table></div></div><p><strong><span style="text-decoration: underline; font-size: 18px;">实现写时复制</span></strong></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;看完上面的三个例子，相信大家也可以了解到PHP中COW的实现原理：
PHP中的COW基于引用计数<strong>ref_count</strong>和<strong>is_ref</strong>实现，
多一个变量指针，就将<strong>ref_count</strong>加1，&nbsp;反之减去1，减到0就销毁；
同理，多一个强制引用&amp;,就将<strong>is_ref</strong>加1，反之减去1。</p><p>这里有一个比较典型的例子：</p><p><br></p><div><div id="highlighter_16360" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php&nbsp;&nbsp;</code><code class="php comments">//例四</code></div><div class="line number2 index1 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$foo</code>&nbsp;<code class="php plain">=&nbsp;1;</code></div><div class="line number3 index2 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">xdebug_debug_zval(</code><code class="php string">'foo'</code><code class="php plain">);</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$bar</code>&nbsp;<code class="php plain">=&nbsp;</code><code class="php variable">$foo</code><code class="php plain">;</code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">xdebug_debug_zval(</code><code class="php string">'foo'</code><code class="php plain">);</code></div><div class="line number6 index5 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$bar</code>&nbsp;<code class="php plain">=&nbsp;2;</code></div><div class="line number7 index6 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">xdebug_debug_zval(</code><code class="php string">'foo'</code><code class="php plain">);</code></div><div class="line number8 index7 alt1"><code class="php plain">?&gt;</code></div><div class="line number9 index8 alt2"><code class="php comments">//-----执行结果-----</code></div><div class="line number10 index9 alt1"><code class="php plain">foo:&nbsp;(refcount=1,&nbsp;is_ref=0)=1</code></div><div class="line number11 index10 alt2"><code class="php plain">foo:&nbsp;(refcount=2,&nbsp;is_ref=0)=1</code></div><div class="line number12 index11 alt1"><code class="php plain">foo:&nbsp;(refcount=1,&nbsp;is_ref=0)=1</code></div></div></td></tr></tbody></table></div></div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;经过前面对变量章节的介绍，我们知道当$foo被赋值时，$foo变量的值的只由$foo变量指向。
当$foo的值被赋给$bar时，PHP并没有将内存复制一份交给$bar，而是把$foo和$bar指向同一个地址。
同时引用计数增加1，也就是新的2。
随后，我们更改了$bar的值，这时如果直接需该$bar变量指向的内存，则$foo的值也会跟着改变。
这不是我们想要的结果。于是，PHP内核将内存复制出来一份，并将其值更新为赋值的：2（这个操作也称为变量分离操作），
同时原$foo变量指向的内存只有$foo指向，所以引用计数更新为：refcount=1。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;看上去很简单，但由于<strong>&amp;</strong>运算符的存在，实际的情形要复杂的多。
见下面的例子：
</p><p><img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/d009b3de9c82d1582ae1ae62800a19d8bd3e4286.jpg" width="640"></p><p style="text-align: left;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;图6.6&nbsp;&amp;操作符引起的内存复制分离</p><p style="text-align: left;"><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从这个例子可以看出PHP对<strong>&amp;</strong>运算符的一个容易出问题的处理：当&nbsp;$beauty=&amp;$pan;&nbsp;时，
两个变量本质上都变成了引用类型，导致看上去的普通变量$pan,&nbsp;在某些内部处理中与&amp;$pan行为相同，
尤其是在数组元素中使用引用变量，很容易引发问题。（见最后的例子）</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHP的大多数工作都是进行文本处理，而变量是载体，不同类型的变量的使用贯穿着PHP的生命周期，
变量的COW策略也就体现了Zend引擎对变量及其内存处理，具体可以参阅源码文件相关的内容：</p><p style="text-align: left;"><br></p><div><div id="highlighter_865583" class="syntaxhighlighter  cpp"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">Zend/zend_execute.c</code></div><div class="line number2 index1 alt1"><code class="cpp plain">========================================</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">zend_assign_to_variable_reference();</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">zend_assign_to_variable();</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">zend_assign_to_object();</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">zend_assign_to_variable();</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number8 index7 alt1"><code class="cpp comments">//以及下列宏定义的使用</code></div><div class="line number9 index8 alt2"><code class="cpp plain">Zend/zend.h</code></div><div class="line number10 index9 alt1"><code class="cpp plain">========================================</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">#define&nbsp;Z_REFCOUNT(z)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z_REFCOUNT_P(&amp;(z))</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">#define&nbsp;Z_SET_REFCOUNT(z,&nbsp;rc)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z_SET_REFCOUNT_P(&amp;(z),&nbsp;rc)</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">#define&nbsp;Z_ADDREF(z)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z_ADDREF_P(&amp;(z))</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">#define&nbsp;Z_DELREF(z)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z_DELREF_P(&amp;(z))</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">#define&nbsp;Z_ISREF(z)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z_ISREF_P(&amp;(z))</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">#define&nbsp;Z_SET_ISREF(z)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z_SET_ISREF_P(&amp;(z))</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">#define&nbsp;Z_UNSET_ISREF(z)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z_UNSET_ISREF_P(&amp;(z))</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">#define&nbsp;Z_SET_ISREF_TO(z,&nbsp;isref)&nbsp;&nbsp;&nbsp;&nbsp;Z_SET_ISREF_TO_P(&amp;(z),&nbsp;isref)</code></div></div></td></tr></tbody></table></div></div><p><strong><span style="text-decoration: underline; font-size: 18px;">最后，请慎用引用&amp;</span></strong></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引用和前面提到的变量的引用计数和PHP中的引用并不是同一个东西，
引用和C语言中的指针的类似，他们都可以通过不同的标示访问到同样的内容，
但是PHP的引用则只是简单的变量别名，没有C指令的灵活性和限制。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PHP中有非常多让人觉得意外的行为，有些因为历史原因，不能破坏兼容性而选择
暂时不修复，或者有的使用场景比较少。在PHP中只能尽量的避开这些陷阱。
例如下面这个例子。</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于引用操作符会导致PHP的COW策略优化，所以使用引用也需要对引用的行为有明确的认识才不至于误用，
避免带来一些比较难以理解的的Bug。如果您认为您已经足够了解了PHP中的引用，可以尝试解释下面这个例子：</p><div><div id="highlighter_467909" class="syntaxhighlighter  php"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php variable">$foo</code><code class="php plain">[</code><code class="php string">'love'</code><code class="php plain">]&nbsp;=&nbsp;1;</code></div><div class="line number3 index2 alt2"><code class="php variable">$bar</code>&nbsp;&nbsp;<code class="php plain">=&nbsp;&amp;</code><code class="php variable">$foo</code><code class="php plain">[</code><code class="php string">'love'</code><code class="php plain">];</code></div><div class="line number4 index3 alt1"><code class="php variable">$tipi</code>&nbsp;<code class="php plain">=&nbsp;</code><code class="php variable">$foo</code><code class="php plain">;</code></div><div class="line number5 index4 alt2"><code class="php variable">$tipi</code><code class="php plain">[</code><code class="php string">'love'</code><code class="php plain">]&nbsp;=&nbsp;</code><code class="php string">'2'</code><code class="php plain">;</code></div><div class="line number6 index5 alt1"><code class="php functions">echo</code>&nbsp;<code class="php variable">$foo</code><code class="php plain">[</code><code class="php string">'love'</code><code class="php plain">];</code></div></div></td></tr></tbody></table></div></div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个例子最后会输出&nbsp;2&nbsp;，&nbsp;大家会非常惊讶于$tipi怎么会影响到$foo,&nbsp;
$bar变量的引用操作，将$foo['love']污染变成了引用，从而Zend没有
对$tipi['love']的修改产生内存的复制分离。<br></p><p><br></p> </div>    <div class="mod-tagbox clearfix">   <a class="tag" href="http://hi.baidu.com/tag/php/feeds">#php</a>    <a class="tag" href="http://hi.baidu.com/tag/copy-on-write/feeds">#copy-on-write</a>  </div> <div class="mod-post-info clearfix">  <div class="x-bdshare">  <div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare" data="{&#39;wbuid&#39;:1727466295}"> <span class="bds_more">分享到：</span> <a class="bds_qzone" title="分享到QQ空间" href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#"></a> <a class="bds_tsina" title="分享到新浪微博" href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#"></a> <a class="bds_tqq" title="分享到腾讯微博" href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#"></a> <a class="bds_renren" title="分享到人人网" href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#"></a> </div> <script id="bdshare_js" data="type=tools&amp;uid=713670" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/bds_s_v2.js"></script>  <script>
        var bds_config = {'bdTop':240};
                    var all_img = qing.g('content').getElementsByTagName('img');
            if(all_img.length>0){
                bds_config.bdPic = all_img[0].src;
            }
                document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?v=72836429.js?cdnversion=" + Math.ceil(new Date()/3600000);
    </script> </div> <div class="op-box mod-cs-opBox">  <a class="report-btn" target="_blank" href="http://tousu.baidu.com/hi.add?tsurl=http%3A%2F%2Fhi.baidu.com%2Fcxc0378%2Fitem%2Fde2441e784fabb0c64db0011"> 举报 </a>  <span class="pv">浏览(341)</span> <a class="comment-bnt" id="commentBnt" href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" onclick="return false"> 评论<span class="comment-nub">(1)</span> </a>   <a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" id="shareBnt" onclick="return false" class="share-bnt"> 转载<span id="shareNub" class="share-nub">(1)</span> </a>   </div> </div>   </div>    <div class="mod-share-detail" id="shareDetail" style="display:none"></div>   <div class="mod-relate-blogs" id="relateBlog"> <h3 class="relate-title">你可能也喜欢</h3> <ul class="relate-blog-list clearfix">   <li class="first"> <a href="http://hi.baidu.com/cookietina1959/item/972adbfd4ba5c410ce9f32d0" target="_blank" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_img"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/b151f8198618367a050767912f738bd4b21ce5f4.jpg" class="relate-img" alt="【盗墓笔记】美爆了！！++++++解语花中心COS《人生如戏》++++++" title="【盗墓笔记】美爆了！！++++++解语花中心COS《人生如戏》++++++"> </a> <a href="http://hi.baidu.com/cookietina1959/item/972adbfd4ba5c410ce9f32d0" target="_blank" class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_txt">【盗墓笔记】美爆了！！++++++解语花中心COS《人生如戏》++++++</a>    </li><li> <a href="http://hi.baidu.com/a_koako/item/79275bf15a99eeea1b111fa1" target="_blank" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_img"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/0dd7912397dda144b3a514efb3b7d0a20cf4863a.jpg" class="relate-img" alt="【k cos】伏八 军服同人" title="【k cos】伏八 军服同人"> </a> <a href="http://hi.baidu.com/a_koako/item/79275bf15a99eeea1b111fa1" target="_blank" class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_txt">【k cos】伏八 军服同人</a>    </li><li> <a href="http://hi.baidu.com/1529629266/item/746419049a5036fd34990254" target="_blank" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_img"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/3801213fb80e7bec10e30cbf2e2eb9389b506bb6.jpg" class="relate-img" alt="白马湖-- 动漫节" title="白马湖-- 动漫节"> </a> <a href="http://hi.baidu.com/1529629266/item/746419049a5036fd34990254" target="_blank" class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_txt">白马湖-- 动漫节</a>    </li><li> <a href="http://hi.baidu.com/shangyuxuanb/item/4523c6a6d87257df14329b6e" target="_blank" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_img"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/09fa513d269759ee5bec999db3fb43166d22df2c.jpg" class="relate-img" alt="【COS】千与千寻" title="【COS】千与千寻"> </a> <a href="http://hi.baidu.com/shangyuxuanb/item/4523c6a6d87257df14329b6e" target="_blank" class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_txt">【COS】千与千寻</a>    </li><li> <a href="http://hi.baidu.com/shioli33/item/d414e4f0cb76d95ec8f33706" target="_blank" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_img"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/42166d224f4a20a45e7528a991529822720ed070.jpg" class="relate-img" alt="【COS】秦时明月 少司命COSPLAY" title="【COS】秦时明月 少司命COSPLAY"> </a> <a href="http://hi.baidu.com/shioli33/item/d414e4f0cb76d95ec8f33706" target="_blank" class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_txt">【COS】秦时明月 少司命COSPLAY</a>    </li><li> <a href="http://hi.baidu.com/guotanga/item/43cc8adc76a20af9b3f777e3" target="_blank" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_img"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/95eef01f3a292df5c610e943bd315c6035a87390.jpg" class="relate-img" alt="“星女郎”徐娇神级COS《中二病》" title="“星女郎”徐娇神级COS《中二病》"> </a> <a href="http://hi.baidu.com/guotanga/item/43cc8adc76a20af9b3f777e3" target="_blank" class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_txt">“星女郎”徐娇神级COS《中二病》</a>    </li><li> <a href="http://hi.baidu.com/cxc0378/item/a29fb0e6af7ae1e3fb42ba47" target="_blank" class="qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_img"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/c2fdfc039245d688d5334a0ea4c27d1ed21b2462.jpg" class="relate-img" alt="定期优化表结构的存储过程[转]" title="定期优化表结构的存储过程[转]"> </a> <a href="http://hi.baidu.com/cxc0378/item/a29fb0e6af7ae1e3fb42ba47" target="_blank" class="relate-txt qing-stat-nsclick" data-nsclick="m_20121105_detail_relates_txt">定期优化表结构的存储过程[转]</a>   </li></ul> </div>   <div class="mod-detail-pager clearfix">  <div class="detail-nav-pre"> <a href="http://hi.baidu.com/cxc0378/item/3935563637ba1849033edc84" hidefocus="" title="上一篇"></a> </div>   <div class="detail-nav-next"> <a href="http://hi.baidu.com/cxc0378/item/66f7ce057673d3dcdce5b066" hidefocus="" title="下一篇"></a> </div>  </div>   <div id="commentDetail" class="mod-comment-detail clearfix mod-cs-comment">   <div class="mod-recent-readers"> <h3 class="recent-readers-title">本文最近访客</h3> <ul class="readers-list clearfix">    <li class="first"> <a target="_blank" href="http://hi.baidu.com/jxbypp"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/e1fe9925bc315c601b8d32458db1cb134954777b.jpg" title="jxbypp" alt="jxbypp" class="portrait"> </a> <a target="_blank" href="http://hi.baidu.com/jxbypp" class="user-name" title="jxbypp"> jxbypp </a> <div class="visit-time" data-visit-time="1372410726">6月28日</div>      </li><li> <a target="_blank" href="http://hi.baidu.com/ryan_dream"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/d833c895d143ad4bd5b39b5982025aafa50f068d.jpg" title="Ryan_Dream" alt="Ryan_Dream" class="portrait"> </a> <a target="_blank" href="http://hi.baidu.com/ryan_dream" class="user-name" title="Ryan_Dream"> Ryan_Dream </a> <div class="visit-time" data-visit-time="1370444264">6月5日</div>      </li><li> <a target="_blank" href="http://hi.baidu.com/javacao"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/730e0cf3d7ca7bcb2422e68abe096b63f624a83d.jpg" title="javacao" alt="javacao" class="portrait"> </a> <a target="_blank" href="http://hi.baidu.com/javacao" class="user-name" title="javacao"> javacao </a> <div class="visit-time" data-visit-time="1367544281">5月3日</div>      </li><li> <a target="_blank" href="http://hi.baidu.com/swordswift"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/962bd40735fae6cd97ba69ce0fb30f2442a70f17.jpg" title="swordswift" alt="swordswift" class="portrait"> </a> <a target="_blank" href="http://hi.baidu.com/swordswift" class="user-name" title="swordswift"> swordswift </a> <div class="visit-time" data-visit-time="1364749953">4月1日</div>      </li><li> <a target="_blank" href="http://hi.baidu.com/mybess"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/d31b0ef41bd5ad6e1f10454481cb39dbb7fd3cb6.jpg" title="小猫爬树" alt="小猫爬树" class="portrait"> </a> <a target="_blank" href="http://hi.baidu.com/mybess" class="user-name" title="小猫爬树"> 小猫爬树 </a> <div class="visit-time" data-visit-time="1363865023">3月21日</div>      </li><li> <a target="_blank" href="http://hi.baidu.com/canglong78"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/3812b31bb051f8195fb004e5dab44aed2f73e78c.jpg" title="canglong78" alt="canglong78" class="portrait"> </a> <a target="_blank" href="http://hi.baidu.com/canglong78" class="user-name" title="canglong78"> canglong78 </a> <div class="visit-time" data-visit-time="1358566715">1月19日</div>      </li><li> <a target="_blank" href="http://hi.baidu.com/bocaikongjian"> <img src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/f703738da97739120d5cfacff8198618367ae222.jpg" title="bocaikongjian" alt="bocaikongjian" class="portrait"> </a> <a target="_blank" href="http://hi.baidu.com/bocaikongjian" class="user-name" title="bocaikongjian"> bocaikongjian </a> <div class="visit-time" data-visit-time="1356769497">12月29日</div>    </li></ul> </div>  <div class="comment-title">评论</div> <div class="comment-content" style="display: block; height: auto; overflow: visible;"><div id="qcmt1611977" class="qcmt-wraper-box-comment "><div class="cmt-border-top"></div><div class="qcmt-arrow-wraper" style="left:664px;"><div class="qcmt-arrow-border"></div><div class="qcmt-arrow-shadow"></div><div class="qcmt-arrow"></div><div class="qcmt-arrow-inner"></div></div><div class="qcmt-input-box clearfix"><div class="qcmt-input-textarea-box"><div class="qcmt-textarea-wraper"><div class="qcmt-textarea-minishadow clearfix"><div class="qcmt-tag-box"></div><textarea class="qcmt-textarea-box" style="overflow: hidden;"></textarea></div></div><div class="qcmt-input-repost-checkbox left"><div class="qcmt-reply-friend hide"><input type="checkbox" name="comment" class="qcmt-reply-friend-check" id="repostCheckFriend" checked="">&nbsp;<label for="repostCheckFriend">同时评论给&nbsp; </label></div><div class="qcmt-reply-author hide"><input type="checkbox" name="comment" class="qcmt-reply-author-check" id="repostCheckAuthor" checked="">&nbsp;<label for="repostCheckAuthor">同时评论给原文作者&nbsp; </label></div></div></div><div class="qcmt-face-entrance"></div><div class="qcmt-sub-bt-box"><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="cmt-add button button-save button-cmt clearfix"><span class="button-left">&nbsp;</span><span class="button-text">发布</span><span class="button-right">&nbsp;</span></a><div class="qcmt-input-textnum-tip right hide"><span class="num-box num-total">500</span><span class="num-box num-l">/</span><span class="num-box now-num">0</span></div></div></div><div class="qcmt-main-wraper"><div class="qcmt-main-box"><div class="qcmt-list-wraper"><div class="cmt-list"><div class="cmt-item" data-cmt-id="655e28246d6d1ad80f37f952" id="655e28246d6d1ad80f37f952"><div class="cmt-item-content clearfix"><div class="cmt-content-box"><div class="cmt-content-detail"><a class="cmt-item-portrait" href="http://hi.baidu.com/go/check?portrait=431c66616b650607" title="zhangpeng0926" data-user-id="431c616e647964616f70656e670607" target="_blank"><img alt="zhangpeng0926" src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/scrop=40"></a><a class="cmt-user-name cs-contentblock-link" href="http://hi.baidu.com/go/check?portrait=431c66616b650607" target="_blank">zhangpeng0926</a>不错的，可惜有点看不懂<span class="wise-ico hide" title="来自空间手机版">&nbsp;</span></div><div class="cmt-pub-time">2013-03-07 11:09</div><div class="cmt-control-box"><a href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#" class="cmt-reply  cs-contentblock-link">回复</a></div></div></div><div class="cmt-mini-border"></div></div></div></div><div class="qcmt-footer-wraper"><div class="qcmt-footer-box clearfix"><a class="qcmt-collapse" href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#"><span class="collapse-arrow"></span><span class="collapse-tip cs-contentblock-link">收起</span></a><span class="qcmt-vl hide">|</span><a class="cmt-seemore cmt-seenext hide" href="http://hi.baidu.com/cxc0378/item/de2441e784fabb0c64db0011#reply" target="_blank"><span class="seemore-arrow hide"></span><span class="seemore-tip cs-contentblock-link">查看更多</span></a><span class="seemore-loading hide"></span></div></div></div></div></div></div> </div>   </div>  </div>  </div> </div> </section>  <footer class="mod-footer mod-cs-footer"><div class="clearfix hidden-box"></div><div class="footer-box"><div class="inner-box"><a href="http://help.baidu.com/question?prod_en=hi" target="_blank">帮助中心</a><span>&nbsp;|&nbsp;</span><a href="http://tieba.baidu.com/p/1781683739" target="_blank">空间客服</a><span>&nbsp;|&nbsp;</span><a href="http://tousu.baidu.com/hi/add" target="_blank">投诉中心</a><span>&nbsp;|&nbsp;</span><a href="http://www.baidu.com/search/hi_contract.html" target="_blank">空间协议</a></div><div class="copy-box">©2013&nbsp;Baidu</div></div></footer>  <script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/mod_foot.js"></script> <script>
        	qing.dom.ready(function(){
                if (qVisitorInfo.loginStatus == 'activated'){
                    qext.stat.ns('m_20121012_loga_num');
					qext.fn.setStoken();
				}
			});
        </script>        <script>qext.stat.ns('m_20120425_');</script>  <script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/qcmt_import.js"></script>  <script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/shCore.js"></script> <script>
        SyntaxHighlighter.highlight();
    </script>   <script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/detail.js"></script>   <!--[if (lt IE 8.0)]><link rel=stylesheet type=text/css href="http://hi.bdimg.com/static/qmessage/css/qmessage_mod_msg_bubble.css?v=a727011c.css"><![endif]--><!--[if (!IE)|(gte IE 8.0)]><!--><link rel="stylesheet" type="text/css" href="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/qmessage_mod_msg_bubble_datauri.css"><!--<![endif]--><script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/boot_qmessage_mod_bubble.js"></script><link href="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/yoyo.css" type="text/css" rel="stylesheet"><script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/yoyo.js"></script><script>wpo.tti=new Date*1;</script><script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/allsite.js"></script><script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/mod_bubble.js"></script><script>document.write(unescape("%3Cscript src='http://hm.baidu.com/h.js%3F8c869b543955d43e496c2efee5b55823' type='text/javascript'%3E%3C/script%3E"));qext.stat.ns('m_20120713_qing_pv');</script><script src="./PHP 之 写时复制（Copy On Write）_Premier's Casual Home_百度空间_files/h.js" type="text/javascript"></script><div id="qBack2topBtn" style="bottom: 1%; margin-left: 490px; width: 57px; height: 57px; overflow: hidden; cursor: pointer; left: 50%; -webkit-transition: opacity; transition: opacity; position: fixed; opacity: 0.6; display: block;"><div class="back2top-ani-icon" style=""><div class="back2top-icon-bg"></div><div class="back2top-icon-real"></div></div></div><div style="height: 1px;left: 1px;overflow: hidden;position: absolute;top: 1px;width: 1px;background:#000" id="sr_swfContainer"><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" id="sr_swf" width="1" height="1" align="middle"><param name="wmode" value="opaque"><param name="allowscriptaccess" value="always"><param name="movie" value="http://hi.bdimg.com/static/qmessage/swf/longpolling.swf?v=c114dc3e.swf?swfran=3641374048561777"><embed width="1" height="1" wmode="opaque" allowscriptaccess="always" allownetworking="all" align="middle" src="http://hi.bdimg.com/static/qmessage/swf/longpolling.swf?v=c114dc3e.swf?swfran=3641374048561777" name="sr_swf" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer"></object></div><div id="TANGRAM$7" class="mod-yoyo-seed-item mod-user-unselect" style="z-index: 99999; display: none; position: absolute; overflow: hidden; width: 36px; height: 36px;"><a href="http://hi.baidu.com/pub/show/createmusic" class="mod-yoyoseed-item music" title="发布音乐"><div class="yoyo-seed-bg-sprite">a</div></a></div><div id="TANGRAM$8" class="mod-yoyo-seed-item mod-user-unselect" style="z-index: 99999; display: none; position: absolute; overflow: hidden; width: 36px; height: 36px;"><a href="http://hi.baidu.com/fengxueken" class="mod-yoyoseed-item fans" title="我的主页"><div class="yoyo-seed-bg-sprite">b</div></a></div><div id="TANGRAM$9" class="mod-yoyo-seed-item mod-user-unselect" style="z-index: 99999; display: none; position: absolute; overflow: hidden; width: 36px; height: 36px;"><a href="http://hi.baidu.com/home" class="mod-yoyoseed-item home" title="首页"><div class="yoyo-seed-bg-sprite">c</div></a></div><div id="TANGRAM$10" class="mod-yoyo-seed-item mod-user-unselect" style="z-index: 99999; display: none; position: absolute; overflow: hidden; width: 36px; height: 36px;"><a href="http://hi.baidu.com/pub/show/createtext" class="mod-yoyoseed-item text" title="发布文字"><div class="yoyo-seed-bg-sprite">d</div></a></div><div id="TANGRAM$11" class="mod-yoyo-seed-item mod-user-unselect" style="z-index: 99999; display: none; position: absolute; overflow: hidden; width: 36px; height: 36px;"><a href="http://hi.baidu.com/pub/show/createpic" class="mod-yoyoseed-item picture" title="发布图片"><div class="yoyo-seed-bg-sprite">e</div></a></div><div id="TANGRAM$12" class="mod-yoyo-seed-item mod-user-unselect" style="z-index: 99999; display: none; position: absolute; overflow: hidden; width: 36px; height: 36px;"><a href="http://hi.baidu.com/pub/show/createvideo" class="mod-yoyoseed-item video" title="发布视频"><div class="yoyo-seed-bg-sprite">f</div></a></div><div id="TANGRAM$6" class="yoyo-wraper mod-user-unselect" style="z-index: 99999; display: none; position: absolute; overflow: hidden; width: 36px; height: 36px;"></div></body></html>